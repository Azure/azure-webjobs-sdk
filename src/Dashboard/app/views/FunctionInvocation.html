<ng-include src="'app/views/shared/breadcrumb.html'"></ng-include>
<ng-include src="'app/views/shared/Errors.html'"></ng-include>
<ng-include src="'app/views/shared/SdkTeaser.html'"></ng-include>

<div class="row" ng-if="!_sdkNotConfigured">
    <div ng-if="!model" class="col-md-9">Loading...</div>
    <div ng-if="model" class="col-md-9">
        <h3>
            Invocation Details <small ng-bind="model.invocation.functionDisplayTitle"></small>
        </h3>

        <p>
            <a class="btn btn-primary" href="{{_urls.replayFunction(invocationId)}}">Replay Function</a>

            <span ng-if="model.invocation.isRunning()">
                <button ng-if="!model.isAborted && !aborting" class="btn btn-danger" ng-click="abort()"><span class="glyphicon glyphicon-remove"></span> Abort Host</button>
                <button ng-if="aborting" class="btn btn-danger disabled"><span class="glyphicon glyphicon-remove"></span> Aborting...</button>
                <button ng-if="model.isAborted" class="btn btn-danger" disabled>Host abort requested</button>
            </span>
        </p>
                
        <p ng-class="model.invocation.getAlertClass()" class="alert">
            <b>{{model.invocation.getLabelText()}}</b>
            <span ng-bind="model.invocation.statusTimeString"></span> <small ng-if="model.invocation.durationString">({{model.invocation.durationString}} running time)</small>
            <div ng-if="model.invocation.exceptionMessage">
                <span>
                    <b>{{model.invocation.exceptionType}}</b>: {{model.invocation.exceptionMessage}}
                </span>
            </div>
        </p>
        <p>
            <span class="glyphicon glyphicon-flash"></span><span ng-bind="model.trigger"></span>
            <span ng-if="model.ancestor"> on <a title="The parent invocation which triggered this function" href="{{_urls.functionInvocation(model.ancestor.id)}}">{{model.ancestor.functionDisplayTitle}} {{ancestor.id}}</a></span>
        </p>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th class="col-md-2">Parameter</th>
                    <th class="col-md-3">Value</th>
                    <th class="col-md-4">Notes</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-if="model.parameters.length === 0">
                    <td colspan="3">The function has no parameters.</td>
                </tr>
                <tr ng-repeat="param in model.parameters">
                    <td><b>{{param.name}}</b></td>
                    <td>
                        <span ng-if="!param.extendedBlobModel">{{param.argInvokeString}}</span>
                        <span ng-if="param.extendedBlobModel.isBlobMissing">{{param.argInvokeString}} - (The blob does not exist).</span>
                        <span ng-if="param.isParamOwnedSomeoneElse()" title="The existing blob was not generated by the current function invocation." class="glyphicon glyphicon-exclamation-sign not-running"></span>
                        <a ng-if="param.extendedBlobModel && !param.extendedBlobModel.isBlobMissing && !param.extendedBlobModel.isConnectionStringMissing" href="{{_api.sdk.downloadBlob(param.argInvokeString)}}">{{param.argInvokeString}}</a>
                        <span ng-if="param.extendedBlobModel && param.extendedBlobModel.isConnectionStringMissing">{{param.argInvokeString}}</span>
                        <section ng-if="param.isParamOwnedAnotherFunction()">
                            <br /><br />
                            <span>
                                The blob was generated by another
                                <a href="{{_urls.functionInvocation(param.extendedBlobModel.ownerId)}}">function invocation</a>
                            </span>
                        </section>
                    </td>
                    <td ng-if="!param.extendedBlobModel || !param.extendedBlobModel.isConnectionStringMissing">
                        {{param.status}}
                    </td>
                    <td ng-if="param.extendedBlobModel && param.extendedBlobModel.isConnectionStringMissing">
                        {{param.status}} <br /> (<a href="http://go.microsoft.com/fwlink/?LinkID=509995&clcid=0x409">You need to add credentials</a> for {{param.extendedBlobModel.connectionStringKey}} to enable links to blobs).
                    </td>
                </tr>
            </tbody>
        </table>
        <console-output log-url="_api.sdk.functionConsoleLog(model.invocation.id)" supports-incremental-updates="true" console-owner="model.invocation" collapse-by-default="true">
        </console-output>
    </div>
</div>

<div ng-show="invocations.page" class="row">
    <div class="col-md-9">
        <h3>Children <small>Functions triggered by this function</small></h3>
        <ng-include src="'app/views/shared/FunctionInvocationsTable.html'"></ng-include>
    </div>
</div>